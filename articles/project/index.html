<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.66">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <link rel="icon" href="/images/logo.jpg"><title>守拙</title><meta name="description" content="welkin 的互联网小窝">
    <link rel="preload" href="/blog/assets/style-65ae1279.css" as="style"><link rel="stylesheet" href="/blog/assets/style-65ae1279.css">
    <link rel="modulepreload" href="/blog/assets/app-fdc7c009.js"><link rel="modulepreload" href="/blog/assets/index.html-253e4e3b.js"><link rel="modulepreload" href="/blog/assets/index.html-968f6d6d.js"><link rel="prefetch" href="/blog/assets/index.html-c65d6296.js" as="script"><link rel="prefetch" href="/blog/assets/css.html-0ce2c90b.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-f13a5230.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-6c9ebd72.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-c8f4ef9a.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-aeead59c.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-5ca8d4ca.js" as="script"><link rel="prefetch" href="/blog/assets/404.html-f9875e7b.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-0e9a6e06.js" as="script"><link rel="prefetch" href="/blog/assets/css.html-73f9814d.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-afa1da40.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-a624acd0.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-bf27224c.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-9d88ff26.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-e08312ff.js" as="script"><link rel="prefetch" href="/blog/assets/404.html-fdaa90d3.js" as="script"><link rel="prefetch" href="/blog/assets/giscus-765fdce2.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/blog/" class=""><img class="logo" src="/blog/images/logo.jpg" alt="守拙"><span class="site-name can-hide">守拙</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a href="/blog/" class="" aria-label="首页"><!--[--><!--]--> 首页 <!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/welkinzhou/blog" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a href="/blog/" class="" aria-label="首页"><!--[--><!--]--> 首页 <!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/welkinzhou/blog" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading"> <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/blog/articles/project/#脚手架的构建逻辑-vite-为例" class="router-link-active router-link-exact-active sidebar-item" aria-label="脚手架的构建逻辑（Vite 为例）"><!--[--><!--]--> 脚手架的构建逻辑（Vite 为例） <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/articles/project/#如何组织项目代码" class="router-link-active router-link-exact-active sidebar-item" aria-label="如何组织项目代码"><!--[--><!--]--> 如何组织项目代码 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/articles/project/#主体颜色切换" class="router-link-active router-link-exact-active sidebar-item" aria-label="主体颜色切换"><!--[--><!--]--> 主体颜色切换 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/articles/project/#plop-脚手架工具" class="router-link-active router-link-exact-active sidebar-item" aria-label="plop 脚手架工具"><!--[--><!--]--> plop 脚手架工具 <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h3 id="脚手架的构建逻辑-vite-为例" tabindex="-1"><a class="header-anchor" href="#脚手架的构建逻辑-vite-为例" aria-hidden="true">#</a> 脚手架的构建逻辑（Vite 为例）</h3><p>Vite 默认的 entry 文件是根目录下的 index.html。在 index.html 文件中，会通过 script 引入 src 下的 main.ts 文件。相当于 index.html 提供 SPA 的主体 html 结构，main.ts 提供 javascript 入口。SPA 是通过 javascript 脚本劫持路由，从而动态响应决定 页面布局的。至于 Vue 文件的入库，默认是 APP.vue，main.ts 中会引入 APP.vue，并将其挂载到真实的 DOM 元素上（index.html 中 会给出接口，默认是一个 id 是 app 的 div）。</p><p>同时，Vite 提供一个 public 目录，这个目录下的文件不会被打包压缩。打包构建中会将这个目录下的文件，原封不动的复制到打包的 输出目录下。</p><h4 id="vite-项目的基本配置" tabindex="-1"><a class="header-anchor" href="#vite-项目的基本配置" aria-hidden="true">#</a> vite 项目的基本配置</h4><p><strong>Step 1： 为了开发方便，首先需要配置 <code>prettier</code>（严格讲，这和 vite 项目没关系）。</strong></p><p>1.安装 <code>prettier</code></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> --save-dev --save-exact prettier
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>2.新建 <code>.prettierrc.json</code> 文件，这里面配置 format 的规则，具体配置看官网</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token builtin class-name">echo</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token operator">&gt;</span> .prettierrc.json
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>3.新建 <code>.prettierignore </code> 文件配置需要忽略文件</p><p>4.配置 eslint 检查规则，使用 prettier 规则</p><p>首先安装 <code>eslint-config-prettier</code></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> --save-dev eslint-config-prettier
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>然后再 <code>.eslintrc.ts</code> 中添加配置</p><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token punctuation">{</span>
  <span class="token string-property property">&quot;extends&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;prettier&quot;</span> <span class="token comment">// &lt;----- add this</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>5.接下来是一些可以不配置的选项，例如 git hooks， 在 pre-commit 中可以配置 prettier 格式化，或者 CI 中打包前运行 <code>prettier --check .</code></p><p><strong>Step 2: 自动导入</strong></p><p>自动导入分为两部分，一部分是第三方库 API 的自动导入，而是 components 的自动导入</p><p>1.安装插件，<code>unplugin-vue-components</code> 自动导入组件(如 element 的所有组件)， <code>unplugin-auto-import</code> 自动导入 API （如 ref，computed)</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> <span class="token parameter variable">-D</span> unplugin-vue-components unplugin-auto-import
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>2.接下来配置 <code>vite.config.ts</code></p><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token keyword">import</span> vue <span class="token keyword">from</span> <span class="token string">&#39;@vitejs/plugin-vue&#39;</span>
<span class="token keyword">import</span> AutoImport <span class="token keyword">from</span> <span class="token string">&#39;unplugin-auto-import/vite&#39;</span>
<span class="token keyword">import</span> Components <span class="token keyword">from</span> <span class="token string">&#39;unplugin-vue-components/vite&#39;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> ElementPlusResolver <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;unplugin-vue-components/resolvers&#39;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token function">vue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">AutoImport</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      dts<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// or a custom path</span>
      <span class="token comment">// targets to transform</span>
      include<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.[tj]sx?$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token comment">// .ts, .tsx, .js, .jsx</span>
        <span class="token operator">/</span>\<span class="token punctuation">.</span>vue$<span class="token operator">/</span><span class="token punctuation">,</span>
        <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.vue\?vue</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token comment">// .vue</span>
        <span class="token operator">/</span>\<span class="token punctuation">.</span>md$<span class="token operator">/</span> <span class="token comment">// .md</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token comment">// global imports to register</span>
      imports<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token comment">// presets</span>
        <span class="token string">&#39;vue&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;vue-router&#39;</span><span class="token punctuation">,</span>
        <span class="token comment">// custom</span>
        <span class="token punctuation">{</span>
          <span class="token string-property property">&#39;@vueuse/core&#39;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token comment">// named imports</span>
            <span class="token string">&#39;useMouse&#39;</span><span class="token punctuation">,</span> <span class="token comment">// import { useMouse } from &#39;@vueuse/core&#39;,</span>
            <span class="token comment">// alias</span>
            <span class="token punctuation">[</span><span class="token string">&#39;useFetch&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;useMyFetch&#39;</span><span class="token punctuation">]</span> <span class="token comment">// import { useFetch as useMyFetch } from &#39;@vueuse/core&#39;,</span>
          <span class="token punctuation">]</span><span class="token punctuation">,</span>
          axios<span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token comment">// default imports</span>
            <span class="token punctuation">[</span><span class="token string">&#39;default&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;axios&#39;</span><span class="token punctuation">]</span> <span class="token comment">// import { default as axios } from &#39;axios&#39;,</span>
          <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      eslintrc<span class="token operator">:</span> <span class="token punctuation">{</span>
        enabled<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token comment">// &lt;-- this，增加 eslint 检测</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      resolvers<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">ElementPlusResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">Components</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      dts<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      dirs<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;src/components&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 默认将 src/components 所有的组件自动全局注册</span>
      types<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token comment">// types 中只声明不引入， vue-router 已经全局注册了这两个组件，这里是为了 ts 类型声明</span>
        <span class="token punctuation">{</span>
          from<span class="token operator">:</span> <span class="token string">&#39;vue-router&#39;</span><span class="token punctuation">,</span>
          names<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;RouterLink&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;RouterView&#39;</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      resolvers<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">ElementPlusResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>AutoImport 中设置了 <code>eslintrc.enable</code> 为 true，可配合 eslint 使用，在当前目录下会生成一个 <code>.eslintrc-auto-import.json</code>文 件，</p><p>需要在 <code>.eslintrc.st</code> 中增加以下配置</p><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token keyword">extends</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token operator">...</span><span class="token punctuation">,</span>
    <span class="token string">&#39;./.eslintrc-auto-import.json&#39;</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>另外使用了 ts 可能还在文件中报错，因为没有引入就使用了 ref 等 vue 的 API，所以在 <code>tsconfig.json</code> 需要引入 AutoImport 的 声明文件</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;include&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;./auto-imports.d.ts&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Step 3：vite 增加 jsx/tsx 拓展</strong></p><p>1.安装插件 <code>@vitejs/plugin-vue-jsx</code></p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>npm install @vitejs/plugin-vue-jsx -D
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>2.配置 <code>vite.config.ts</code></p><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token keyword">import</span> vueJsx <span class="token keyword">from</span> <span class="token string">&#39;@vitejs/plugin-vue-jsx&#39;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token function">vueJsx</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// &lt;----- add this</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>3.确保 <code>tsconfig.json</code> 中配置项 compilerOptions.jsx 是 preserve</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;compilerOptions&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;jsx&quot;</span><span class="token operator">:</span> <span class="token string">&quot;preserve&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Step 4：vite 其他配置</strong></p><p>这里只写两个常见的，其他的看文档吧，添加 <code>vite.config.ts</code> 配置</p><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token keyword">import</span> path <span class="token keyword">from</span> <span class="token string">&#39;path&#39;</span>
<span class="token comment">// get absolute path</span>
<span class="token keyword">const</span> <span class="token function-variable function">resolve</span> <span class="token operator">=</span> <span class="token punctuation">(</span>relativePath<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> relativePath<span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  resolve<span class="token operator">:</span> <span class="token punctuation">{</span>
    alias<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string-property property">&#39;@&#39;</span><span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&#39;src&#39;</span><span class="token punctuation">)</span> <span class="token comment">// path alias</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  server<span class="token operator">:</span> <span class="token punctuation">{</span>
    host<span class="token operator">:</span> <span class="token string">&#39;0.0.0.0&#39;</span> <span class="token comment">// listen on IP address</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Step 5：配置单元测试</strong></p><p>1.安装两个插件 <code>vitest</code> 测试断言库，<code>@vue/test-utils</code> 生成测试组件的工具类。</p><p>2.配置 <code>vitest.config.ts</code>。</p><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> defineConfig <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vitest/config&#39;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  test<span class="token operator">:</span> <span class="token punctuation">{</span>
    transformMode<span class="token operator">:</span> <span class="token punctuation">{</span>
      web<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.[jt]sx$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">]</span> <span class="token comment">// 可以使用tsx jsx</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    environment<span class="token operator">:</span> <span class="token string">&#39;jsdom&#39;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="如何组织项目代码" tabindex="-1"><a class="header-anchor" href="#如何组织项目代码" aria-hidden="true">#</a> 如何组织项目代码</h3><p>明晰脚手架构建逻辑后，可以发现项目结构的重点应该从 main.ts 出发，修改其他结构意义不大。main.ts 提供全局的 javascript 入 库，这样我们可以在这里进行引入一些公共配置的操作（如，使用插件，挂载全局 Vue 属性等）。</p><p>上述操作，并非必须如此。根据个人编写代码的逻辑，可以灵活调整。需要理解入口文件的作用，顾名思义就是一个门面，这样作用也就 好理解了。当我们进入一个商场时，会根据每个门店入口的招牌，来判断这个门店是做什么的。在我们的入口文件中，应该引入偏项目底 层的公共配置，这样就能知道项目大概会有什么功能。</p><h3 id="主体颜色切换" tabindex="-1"><a class="header-anchor" href="#主体颜色切换" aria-hidden="true">#</a> 主体颜色切换</h3><p>切换主体的基本思路，就是替换 css 变量值。实现思路也很简单，暗黑模式增加 class，或者 color-scheme，再修改 body 或者 :root 中的 css 变量，覆盖原始值。</p><p><code>Tips: VueUse 是一个工具库，提供一些常用的 hooks</code></p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> useDark<span class="token punctuation">,</span> useToggle <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@vueuse/core&#39;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> isDark <span class="token operator">=</span> <span class="token function">useDark</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">storageKey</span><span class="token operator">:</span> <span class="token string">&#39;el-theme-appearance&#39;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> toggleDark <span class="token operator">=</span> <span class="token function">useToggle</span><span class="token punctuation">(</span>isDark<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>使用后的 html 结构如下</p><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token comment">&lt;!--light--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
  ...
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!--dark--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dark<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  ...
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="plop-脚手架工具" tabindex="-1"><a class="header-anchor" href="#plop-脚手架工具" aria-hidden="true">#</a> plop 脚手架工具</h3><p>plop 可以集成到项目中，通过 terminal 交互，执行一些创建常见模版，以及可拓展的命令。</p><p>先看例子，慢慢了解：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">plop</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  plop<span class="token punctuation">.</span><span class="token function">setHelper</span><span class="token punctuation">(</span><span class="token string">&#39;formatDate&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> today <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> year <span class="token operator">=</span> today<span class="token punctuation">.</span><span class="token function">getFullYear</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> month <span class="token operator">=</span> today<span class="token punctuation">.</span><span class="token function">getMonth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">&gt;</span> <span class="token number">10</span> <span class="token operator">?</span> today<span class="token punctuation">.</span><span class="token function">getMonth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token string">&#39;0&#39;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>today<span class="token punctuation">.</span><span class="token function">getMonth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>

    <span class="token keyword">const</span> day <span class="token operator">=</span> today<span class="token punctuation">.</span><span class="token function">getDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">10</span> <span class="token operator">?</span> today<span class="token punctuation">.</span><span class="token function">getDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token string">&#39;0&#39;</span> <span class="token operator">+</span> today<span class="token punctuation">.</span><span class="token function">getDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>year<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>month<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>day<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token comment">// page generator</span>
  plop<span class="token punctuation">.</span><span class="token function">setGenerator</span><span class="token punctuation">(</span><span class="token string">&#39;page&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">description</span><span class="token operator">:</span> <span class="token string">&#39;auto create page&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">prompts</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;input&#39;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;name&#39;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">&#39;page name please&#39;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;input&#39;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;title&#39;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">&#39;article title please&#39;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">actions</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;add&#39;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">&#39;target-path/{{dashCase name}}/index.vue&#39;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">templateFile</span><span class="token operator">:</span> <span class="token string">&#39;plop-templates/page.hbs&#39;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Plop 使用 hbs 模版，支持 mustache 语法，用起来很容易上手，和 vue 中常用的插值类似，使用 <code>{{ content }}</code>，向模版插入内容 。</p><p>通过 prompt 设置 terminal 交互，type 设置交互类型，具体可以看 <a href="https://github.com/SBoudrias/Inquirer.js/" target="_blank" rel="noopener noreferrer">Inquirer.js<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>。name 就是传递给 action，模板使用的变量。</p><p>这里设置了一个 helper，helper 可以直接在模版中使用，上述的 formatDate helper 没有使用参数，在模板中 <code>{{ formatDate }}</code> 就会调用这个函数，假如有参数 <code>{{ formatDate date }}</code> 这样就可以调用。</p><p>actions 中放置的是需要执行的操作，<code>type: &#39;add&#39;</code> 说明执行的操作是新增文件或文件夹，path 代表新增文件的路由，templateFile 是模版路径。</p><p>一般来说，新建页面后，我们仍需创建页面对应路由，这样才能访问到。手动修改很麻烦，幸好 plop 也支持 customAction。只需在 actions 中插入一个方法，即可执行自己想要的操作了。</p><p>如下：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">import</span> routeMerge <span class="token keyword">from</span> <span class="token string">&#39;./routeMerge.js&#39;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">plop</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// page generator</span>
  plop<span class="token punctuation">.</span><span class="token function">setGenerator</span><span class="token punctuation">(</span><span class="token string">&#39;page&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>
    <span class="token literal-property property">actions</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token operator">...</span><span class="token punctuation">,</span>
      <span class="token keyword">function</span> <span class="token function">generateRoute</span><span class="token punctuation">(</span><span class="token parameter">answers</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// answers 包含 terminal 获取的所有参数</span>
        <span class="token function">routeMerge</span><span class="token punctuation">(</span>answers<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>接下来就是 routeMerge 这个方法。</p><p>继续进行之前，需要补充一点点 node 的知识。js 文件除了常见的 .js 后缀，还会有 .cjs，.mjs 这些后缀。之所以这么多后缀，属于 历史遗留问题。</p><p>总所周知，一开始 js 是没有模块的，所有的方法和变量都是挂载到全局。显而易见，这样会有命名重复，导致变量覆盖的问题。项目达 到一定程度时，这个问题基本上不可避免的。当时社区的解决办法是，立即执行函数（IIFEs）。时至今日，依旧有一些包用的是这种模 式，比如说百度地图的部分插件。</p><p>后来也出现了一些规范，其中就有 commonJs 规范，node 早期采用的就是 commonJs。后来 ECMAScript 开始尝试规范化 JS，也就出现 了 ES6 中的模块化。node 在 ECMAScript 推出 ES6 后，也积极拥抱新规范。切换的过程中，难免出现两种规范并行的情况。为了区分 规范，使用 .cjs 代表 commonJs，.mjs 代表 ES6 module。后续 node 升级后，可以通过 package.json 的 type 指定默认的 js 规范 。我使用的是 <code>&quot;type&quot;: &quot;module&quot;</code>，当时用 js 文件时就会自动使用 ES module 规范。</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> fs <span class="token keyword">from</span> <span class="token string">&#39;node:fs/promises&#39;</span>
<span class="token keyword">import</span> path <span class="token keyword">from</span> <span class="token string">&#39;path&#39;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> fileURLToPath <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;url&#39;</span>
<span class="token comment">// ES module 规范下 并没有全局的 __filename 和 __dirname，需要创建</span>
<span class="token keyword">const</span> __filename <span class="token operator">=</span> <span class="token function">fileURLToPath</span><span class="token punctuation">(</span><span class="token keyword">import</span><span class="token punctuation">.</span>meta<span class="token punctuation">.</span>url<span class="token punctuation">)</span>

<span class="token keyword">const</span> __dirname <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">dirname</span><span class="token punctuation">(</span>__filename<span class="token punctuation">)</span>

<span class="token comment">// 这里输入的 name，是被转换成 dashCase 的name， looks-like-this</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">addRoute</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 获取路由文件内容</span>
  <span class="token keyword">const</span> absPath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&#39;./src/router/article.ts&#39;</span><span class="token punctuation">)</span>
  <span class="token comment">// 读取文件，使用 utf-8</span>
  <span class="token keyword">let</span> file <span class="token operator">=</span> <span class="token keyword">await</span> fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span>absPath<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">encoding</span><span class="token operator">:</span> <span class="token string">&#39;utf-8&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token comment">// 去除字符串中空字符</span>
  file <span class="token operator">=</span> file<span class="token punctuation">.</span><span class="token function">replaceAll</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\s</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">)</span>
  <span class="token comment">// 匹配 routes 数组内容</span>
  <span class="token keyword">const</span> reg <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\[.*\]</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span>
  <span class="token keyword">const</span> arrStr <span class="token operator">=</span> file<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>reg<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
  <span class="token keyword">const</span> newArr <span class="token operator">=</span> <span class="token function">replaceImport</span><span class="token punctuation">(</span>arrStr<span class="token punctuation">)</span>
  <span class="token comment">// 提取后数据转换成数组</span>
  <span class="token keyword">const</span> routes <span class="token operator">=</span> <span class="token function">eval</span><span class="token punctuation">(</span>newArr<span class="token punctuation">)</span>
  <span class="token keyword">const</span> comName <span class="token operator">=</span> <span class="token function">camelCase</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
  <span class="token keyword">const</span> newRoute <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> comName<span class="token punctuation">,</span>
    <span class="token literal-property property">component</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">@/views/articles/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/index.vue</span><span class="token template-punctuation string">`</span></span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 推入新路由</span>
  routes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>newRoute<span class="token punctuation">)</span>
  <span class="token keyword">let</span> replacedRoutes <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token function">routeToString</span><span class="token punctuation">(</span>routes<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token comment">// 替换 () =&gt; { * } 前后的 &quot;</span>
  replacedRoutes <span class="token operator">=</span> replacedRoutes<span class="token punctuation">.</span><span class="token function">replaceAll</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\&quot;(\(\)=&gt;import\(.*?\))\&quot;</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">&#39;$1&#39;</span><span class="token punctuation">)</span>

  <span class="token keyword">const</span> content <span class="token operator">=</span> <span class="token string">&#39;const routes =&#39;</span> <span class="token operator">+</span> replacedRoutes <span class="token operator">+</span> <span class="token string">&#39;\n export default routes&#39;</span>
  <span class="token comment">// 写入新路由</span>
  fs<span class="token punctuation">.</span><span class="token function">writeFile</span><span class="token punctuation">(</span>absPath<span class="token punctuation">,</span> content<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 将 dash-case 风格的字符串转成 camelCase 风格</span>
<span class="token keyword">function</span> <span class="token function">camelCase</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> words <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&#39;-&#39;</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> camelStr <span class="token operator">=</span> words<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">acc<span class="token punctuation">,</span> cur</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> firstLetter <span class="token operator">=</span> cur<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> rest <span class="token operator">=</span> cur<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    acc <span class="token operator">=</span> acc <span class="token operator">+</span> firstLetter<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> rest
    <span class="token keyword">return</span> acc
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> camelStr
<span class="token punctuation">}</span>

<span class="token comment">// 转换路由信息数组</span>
<span class="token keyword">function</span> <span class="token function">routeToString</span><span class="token punctuation">(</span><span class="token parameter">routes</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> temp <span class="token operator">=</span> routes<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">route</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> children <span class="token operator">=</span> route<span class="token punctuation">.</span>children
    <span class="token comment">// 如果有子级路由，先转换子级</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>children <span class="token operator">&amp;&amp;</span> Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>children<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      route<span class="token punctuation">.</span>children <span class="token operator">=</span> <span class="token function">routeToString</span><span class="token punctuation">(</span>children<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>route<span class="token punctuation">.</span>component<span class="token punctuation">)</span> route<span class="token punctuation">.</span>component <span class="token operator">=</span> <span class="token function">toImport</span><span class="token punctuation">(</span>route<span class="token punctuation">.</span>component<span class="token punctuation">)</span>
    <span class="token keyword">return</span> route
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> temp
<span class="token punctuation">}</span>

<span class="token comment">// 替换打包工具动态导入文件语法</span>
<span class="token keyword">function</span> <span class="token function">replaceImport</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 使用 ? 转换成非贪婪，小心你匹配多了</span>
  <span class="token keyword">const</span> temp <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">replaceAll</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\(\)=&gt;import\((.*?)\)</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">&#39;$1&#39;</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> temp
<span class="token punctuation">}</span>
<span class="token comment">// 将文件 url 拼接成动态导入形式</span>
<span class="token keyword">function</span> <span class="token function">toImport</span><span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">()=&gt;import(&#39;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&#39;)</span><span class="token template-punctuation string">`</span></span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面的方法，如果直接使用正则匹配，把新路由写入进去或许会简单一点。这只是我个人的想法，有很多问题。</p><p>接下来讲一下我的思路，以及部分转换的理由。</p><p>在 vue 项目中，通常是导出一个路由数组。我这里的路由 component 使用的的动态导入，这个是 vite 或者 webpeck 的语法，类似这 样：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> route <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">&#39;/article&#39;</span><span class="token punctuation">,</span>
    <span class="token function-variable function">component</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span>components<span class="token operator">-</span>path<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token operator">...</span>
<span class="token punctuation">}</span><span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>最直接的想法就是，在 node 中读取 route 作为数组，向数组中 push 一个新的对象，再将得到的结果输出到文件中。简单的思路，实 践中存在几个问题。</p><p>首先读取 route 数组是否可取，根据我目前的尝试，是有问题的。不单单是因为我 routeMerge 使用的是 js， route 文件使用的 ts（ 离谱，我怎么会这么写，可能是懒吧）。更重要的是，我们实际上修改的不是运行时获取的对象，而是本地的代码 ，<code>component: () =&gt; import(components-path)</code> 是要经过 vite 编译的。</p><p>另外几个问题也和第一个问题相关。如果不能直接导入数组，那就获取字符串，将字符串转化成数组咯。在上面的代码中，我使用正则将 数组提取出来，本来想直接使用 eval 转化成数组（没想到别的好办法，谁来救救孩子）。转换之后，发现 component 是一个函数。形 式上看，没错它就是一个 lambda 函数。我们希望它保持 <code>component: () =&gt; import(components-path)</code> 的形式， component 必须是 一个字符串。这就有了 <code>replaceImport</code> 方法，将 lambda 函数转换成对应组件的路由。</p><p>接着就是重写路由文件时，转换成 JSON 是键值都会转换成 &quot;&quot; 包含的字符串。 <code>() =&gt; import(components-path)</code> 如果是字符串就不 会执行，这样还需要一次转换。</p><p>基本上就是这样子。</p></div><!--[--><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: welkin105380@163.com">welkin</span><!----><!--]--><!--]--></span></div></footer><!----><!--[--><!--[--><div id="comment" class="giscus-wrapper input-top" style="display:block;"><div class="loading-icon-wrapper" style="display:flex;align-items:center;justify-content:center;height:96px"><svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" preserveAspectRatio="xMidYMid" viewBox="25 25 50 50"><animateTransform attributeName="transform" type="rotate" dur="2s" keyTimes="0;1" repeatCount="indefinite" values="0;360"></animateTransform><circle cx="50" cy="50" r="20" fill="none" stroke="currentColor" stroke-width="4" stroke-linecap="round"><animate attributeName="stroke-dasharray" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="1,200;90,200;1,200"></animate><animate attributeName="stroke-dashoffset" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="0;-35px;-125px"></animate></circle></svg></div></div><!--]--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/blog/assets/app-fdc7c009.js" defer></script>
  </body>
</html>
